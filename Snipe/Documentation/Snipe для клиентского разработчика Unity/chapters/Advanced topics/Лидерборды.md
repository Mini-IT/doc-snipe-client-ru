#miniit #snipe #snipe-leaderboard #multiplayer #leaderboard

## Общая информация

Лидерборды в той или иной степени используются почти во всех проектах. Лидерборды могут быть для двух типов сущностей - игроков и кланов. Также они могут быть циклическими (с автоматическим сбросом результатов каждые N дней) или перманентными. В циклических лидербордах поддерживается выдача наград (до 100 игроков). Обработка получения наград обычно зависит от проекта, но, как правило, в случае получения игроком награды, просто выставляется флаг “получена награда Х”, и награду нужно забирать отдельным сообщением. Зачем это делается? В этом случае исключается возможность получения награды втихую, так, что игрок этого не заметит. Его внимание будет привлечено окошком и необходимостью нажать кнопку. Это снижает обьем обращений в саппорт “я играл в вашу игру и не получил награду!” и повышает вовлеченность игроков.

## Запросы

В этом модуле всего два запроса, `SnipeApi.Leaderboard.Get` и `SnipeApi.Leaderboard.Place`. Но первый из них, Get, имеет много опциональных аргументов, которые меняют результат:

- `minPlace: int` - минимальное место, с которого нужно получить записи. В любом лидерборде могут быть все игроки проекта, несколько миллионов записей. Чтобы обеспечить работу клиента, нужно подгружать записи кусками и плавно подменять их в компоненте при активном скроллинге вниз или вверх.
- `limit: int` - число записей, которое надо вернуть. По умолчанию (и максимум) 100.
- `getSelf: bool` - при включении вернет отдельно запись самого игрока (только для лидербордов игроков)
- `getPrev: bool` - при включении этого флага будут возвращаться записи из прошлого периода (работает только для лидербордов с ротацией). Также поддерживается запросом `Leaderboard.Place`
- `entityID: int` - вернуть также запись для этой сущности (игрока или клана игрока если это клановый лидерборд)

Формат ответа можно узнать из документации запроса в модуле.

## Инфо игрока

В самом лидерборде в БД хранятся только числовой ID игрока и его очки+место. Но, конечно, визуально лидерборд должен показывать и другую информацию игрока, например его аватару, имя, уровень, а при клике может быть еще и инфо машины или колоды, и прочая и прочая. Для этого в процессе игры на стороне сервера в ключевые моменты формируется и перезаписывается общее инфо игрока. Это упрощенная структура, где из профиля скопированы все нужные для отображения данные. На сторону клиента она приходит JSON-строкой, поскольку ее формат зависит от проекта и не типизирован. В большинстве случаев туда интегрированы аватарка и ID игрока из Фейсбука, если он залогинен в ФБ.

Есть и второй вариант инфо - `customInfo`. Кастомное инфо привязано к конкретному лидерборду и обновляется при записи в него, опять же на стороне сервера. Это инфо используется когда очки напрямую зависят от состояния профиля в момент игры, например ID конкретной машины или уровень который игрок имел когда достиг результата.